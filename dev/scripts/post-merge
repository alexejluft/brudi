#!/bin/bash
# Brudi Post-Merge Hook
# Runs automatically after every `git pull` â€” syncs ~/Brudi/ without manual steps.

REPO_ROOT="$(git rev-parse --show-toplevel)"
REPO_PKG="$REPO_ROOT/skills"
INSTALL_DIR="$HOME/Brudi"

echo "ðŸ”„ Brudi: Syncing after pull..."

if [ ! -d "$INSTALL_DIR" ]; then
  echo "âš ï¸  ~/Brudi/ existiert nicht â€” Ã¼berspringe Sync"
  exit 0
fi

# â”€â”€ Skills â”€â”€
if [ -d "$REPO_PKG/skills" ]; then
  mkdir -p "$INSTALL_DIR/skills"
  cp -r "$REPO_PKG/skills"/. "$INSTALL_DIR/skills/"
  SKILL_COUNT=$(ls "$INSTALL_DIR/skills" | wc -l | tr -d ' ')
  echo "âœ… Skills synced ($SKILL_COUNT skills)"
fi

# â”€â”€ Assets â”€â”€
if [ -d "$REPO_PKG/assets" ]; then
  mkdir -p "$INSTALL_DIR/assets"
  cp -r "$REPO_PKG/assets"/. "$INSTALL_DIR/assets/"
  echo "âœ… Assets synced"
fi

# â”€â”€ Templates â”€â”€
if [ -d "$REPO_PKG/templates" ]; then
  mkdir -p "$INSTALL_DIR/templates"
  cp -r "$REPO_PKG/templates"/. "$INSTALL_DIR/templates/"
  echo "âœ… Templates synced"
fi

# â”€â”€ Orchestration â”€â”€
if [ -d "$REPO_PKG/orchestration" ]; then
  mkdir -p "$INSTALL_DIR/orchestration"
  cp -r "$REPO_PKG/orchestration"/. "$INSTALL_DIR/orchestration/"
  chmod +x "$INSTALL_DIR/orchestration/brudi-gate.sh" 2>/dev/null || true
  chmod +x "$INSTALL_DIR/orchestration/pre-commit" 2>/dev/null || true
  echo "âœ… Orchestration synced"
fi

# â”€â”€ Docs â”€â”€
if [ -d "$REPO_PKG/docs" ]; then
  mkdir -p "$INSTALL_DIR/docs"
  cp -r "$REPO_PKG/docs"/. "$INSTALL_DIR/docs/"
  echo "âœ… Docs synced"
fi

# â”€â”€ Root-Dateien (CLAUDE.md, AGENTS.md, etc.) â”€â”€
for FILE in CLAUDE.md AGENTS.md BOOTSTRAP.md INSTALL.md README.md use.sh install.sh; do
  if [ -f "$REPO_PKG/$FILE" ]; then
    cp "$REPO_PKG/$FILE" "$INSTALL_DIR/$FILE"
  fi
done
echo "âœ… Root files synced"

echo "âœ… Brudi up to date."
